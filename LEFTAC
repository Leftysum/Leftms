-- Services
local VIM = game:GetService("VirtualInputManager")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer

-- GUI Setup
local Gui = Instance.new("ScreenGui", LocalPlayer:WaitForChild("PlayerGui"))
Gui.Name = "LEFTAC"
Gui.ResetOnSpawn = false

local Frame = Instance.new("Frame", Gui)
Frame.Size = UDim2.new(0, 150, 0, 160)
Frame.Position = UDim2.new(1, -160, 0, 30)
Frame.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
Frame.BackgroundTransparency = 0.2
Frame.BorderSizePixel = 0
Frame.Visible = false
Frame.Active = true
Frame.Draggable = true

local ToggleAura = Instance.new("TextButton", Frame)
ToggleAura.Size = UDim2.new(0, 130, 0, 30)
ToggleAura.Position = UDim2.new(0, 10, 0, 10)
ToggleAura.Text = "KillAura OFF"
ToggleAura.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ToggleAura.TextColor3 = Color3.new(1, 1, 1)
ToggleAura.Font = Enum.Font.SourceSansBold
ToggleAura.TextSize = 14

local ToggleNuker = Instance.new("TextButton", Frame)
ToggleNuker.Size = UDim2.new(0, 130, 0, 30)
ToggleNuker.Position = UDim2.new(0, 10, 0, 50)
ToggleNuker.Text = "BedNuker OFF"
ToggleNuker.BackgroundColor3 = Color3.fromRGB(255, 0, 0)
ToggleNuker.TextColor3 = Color3.new(1, 1, 1)
ToggleNuker.Font = Enum.Font.SourceSansBold
ToggleNuker.TextSize = 14

local RangeLabel = Instance.new("TextLabel", Frame)
RangeLabel.Size = UDim2.new(0, 100, 0, 20)
RangeLabel.Position = UDim2.new(0, 25, 0, 90)
RangeLabel.BackgroundTransparency = 1
RangeLabel.Text = "Range: 15"
RangeLabel.TextColor3 = Color3.new(1, 1, 1)
RangeLabel.Font = Enum.Font.SourceSans
RangeLabel.TextSize = 14

local IncreaseRange = Instance.new("TextButton", Frame)
IncreaseRange.Size = UDim2.new(0, 20, 0, 20)
IncreaseRange.Position = UDim2.new(0, 120, 0, 90)
IncreaseRange.Text = "+"
IncreaseRange.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
IncreaseRange.TextColor3 = Color3.new(1, 1, 1)

local DecreaseRange = Instance.new("TextButton", Frame)
DecreaseRange.Size = UDim2.new(0, 20, 0, 20)
DecreaseRange.Position = UDim2.new(0, 0, 0, 90)
DecreaseRange.Text = "-"
DecreaseRange.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
DecreaseRange.TextColor3 = Color3.new(1, 1, 1)

local OpenButton = Instance.new("TextButton", Gui)
OpenButton.Size = UDim2.new(0, 90, 0, 28)
OpenButton.Position = UDim2.new(1, -100, 0, 10)
OpenButton.Text = "Open LEFTAC"
OpenButton.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
OpenButton.BackgroundTransparency = 0.3
OpenButton.TextColor3 = Color3.new(1, 1, 1)
OpenButton.Font = Enum.Font.SourceSansSemibold
OpenButton.TextSize = 13
OpenButton.AutoButtonColor = true

-- GUI Toggle
OpenButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.Touch then
        Frame.Visible = not Frame.Visible
        OpenButton.Text = Frame.Visible and "Close LEFTAC" or "Open LEFTAC"
    end
end)

-- Features
local auraOn = false
local nukerOn = false
local auraRange = 15

IncreaseRange.MouseButton1Click:Connect(function()
    auraRange = math.clamp(auraRange + 1, 1, 18)
    RangeLabel.Text = "Range: " .. auraRange
end)

DecreaseRange.MouseButton1Click:Connect(function()
    auraRange = math.clamp(auraRange - 1, 1, 18)
    RangeLabel.Text = "Range: " .. auraRange
end)

ToggleAura.MouseButton1Click:Connect(function()
    auraOn = not auraOn
    ToggleAura.Text = auraOn and "KillAura ON" or "KillAura OFF"
    ToggleAura.BackgroundColor3 = auraOn and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
end)

ToggleNuker.MouseButton1Click:Connect(function()
    nukerOn = not nukerOn
    ToggleNuker.Text = nukerOn and "BedNuker ON" or "BedNuker OFF"
    ToggleNuker.BackgroundColor3 = nukerOn and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)
end)

-- Helper Functions
local function getClosestEnemy()
    local closest, dist = nil, auraRange
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and p.Character:FindFirstChild("HumanoidRootPart") and p.Character:FindFirstChild("Humanoid") and p.Character.Humanoid.Health > 0 then
            if p.Team ~= LocalPlayer.Team then
                local mag = (LocalPlayer.Character.HumanoidRootPart.Position - p.Character.HumanoidRootPart.Position).Magnitude
                if mag <= dist then
                    closest = p.Character.HumanoidRootPart
                    dist = mag
                end
            end
        end
    end
    return closest
end

local function getClosestBed()
    local closest, dist = nil, auraRange
    for _, obj in pairs(workspace:GetDescendants()) do
        if obj.Name == "bed" and obj:IsA("Part") then
            local mag = (LocalPlayer.Character.HumanoidRootPart.Position - obj.Position).Magnitude
            if mag <= dist then
                closest = obj
                dist = mag
            end
        end
    end
    return closest
end

-- Kill Aura Logic
task.spawn(function()
    while true do
        if auraOn and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local target = getClosestEnemy()
            if target then
                local cam = workspace.CurrentCamera
                local screenPos, onScreen = cam:WorldToViewportPoint(target.Position + Vector3.new(0, 1.5, 0))
                if onScreen then
                    local vp = cam.ViewportSize
                    local x, y = screenPos.X / vp.X, screenPos.Y / vp.Y
                    VIM:SendTouchEvent(1, 0, x, y)
                    VIM:SendTouchEvent(1, 2, x, y)
                end
            end
        end
        task.wait(0.03)
    end
end)

-- Bed Nuker Logic
task.spawn(function()
    while true do
        if nukerOn and LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("HumanoidRootPart") then
            local bed = getClosestBed()
            if bed then
                local args = {
                    [1] = {
                        blockPosition = bed.Position,
                        blockType = "bed",
                        cameraCFrame = workspace.CurrentCamera.CFrame,
                        playerPosition = LocalPlayer.Character.HumanoidRootPart.Position
                    }
                }
                -- Firing the bed break remote (change if needed)
                game:GetService("ReplicatedStorage").rbxts_include.node_modules:FindFirstChild("@rbxts"):FindFirstChild("net").out._NetManaged.BreakBlock:FireServer(unpack(args))
            end
        end
        task.wait(0.3)
    end
end)
